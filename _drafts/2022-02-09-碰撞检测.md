---
layout: post
title: 碰撞检测
tags: [gjk, epa]
comments: true
---

## 碰撞检测的流程

2d碰撞检测有不同的算法，其中一种就是先用GJK算法计算两个物体是否碰撞，然后使用EPA算法计算碰撞向量（碰撞的方向，以及深度），再使用Clipping方法计算Contact Point。到这一步，拿到的碰撞的接触点之后，我们才能通过给接触点apply一些计算出来的冲量，模拟物体碰撞后的物理变化。

#### 总结

1. GJK ---> 判断是否碰撞
2. EPA ---> 计算碰撞向量
3. Clipping ---> 计算Contact Point ---> 对Contact Point施加冲量和角动量

## GJK算法

GJK,全称 Gilbert–Johnson–Keerthi distance algorithm,是非常常用的碰撞检测算法。这里有一个youtube上的[视频](https://gamedevelopment.tutsplus.com/series/how-to-create-a-custom-physics-engine--gamedev-12715)讲述GJK，简明易懂。下面的内容基本是对这个视频的概括。

#### GJK 的主要特性:

1. 只适用于凸体 (后面会解释)
2. GJK 算法与维度无关,2D、3D 都可以用 (这里主要以 2D 为例)
3. 不要求对顶点数组做排序
4. 存在一些技巧可以大大优化 GJK 的性能

#### GJK算法的大致思路

​	首先是两个形状假如相交的话,那么它们必有重叠的部分,那么假如我们用

一个形状包含的所有点减去另一个形状 (Minkowski 差),也会得到一个形
状,而这个形状必然包含原点 (0,0),原因是

1. 有重叠的部分,意味着这部分的点相同,自己减去自己,就是 (0,0) 了
2. 假如是凸包,那么其边上两个点相连,必然是在凸包内部的,而凹体
  就不一定了。(但是为什么会影响 Minkowski 差,我也不是很懂)

​	那么现在判断两个形状是否相加的思路就和 SAT 不一样了,我们是要
判断做了 Minkowski 差后,其是否包含原点,就能判断是否相交。
​	后面就是要找 support point 了,为什么要找它我还不是很懂。但是两
个形状的 support point 相减,就相当于是做了 Minkowski 差后的结果的某
个顶点。先说一下 support point,他就是指定一个方向 d,在这个方向上这
个形状最远的点。
​	当我们拿到几个 Minkowski 差后的结果的顶点,之后,其实就可以开
始判断原点是否包含在这部分里边了。通常是用 simplex 来计算的。如何判
断一个点是否在三角形里边

## EPA算法

## 计算Contact Point

## 参考资料

1. [How to Create a Custom Physics Engine](https://gamedevelopment.tutsplus.com/series/how-to-create-a-custom-physics-engine--gamedev-12715)

2. [A Strange But Elegant Approach to a Surprisingly Hard Problem (GJK Algorithm)](https://www.youtube.com/watch?v=ajv46BSqcK4)

   一个讲解GJK算法的视频，简明易懂

3. [GJK (Gilbert–Johnson–Keerthi)](https://dyn4j.org/2010/04/gjk-gilbert-johnson-keerthi/)

4. [Contact Points Using Clipping](https://dyn4j.org/2011/11/contact-points-using-clipping/)

5. [碰撞检测算法(二)：原始GJK详解](https://www.qiujiawei.com/collision-detection-2/)

